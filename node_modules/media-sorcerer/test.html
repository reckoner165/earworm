<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>MediaSorcerer Demo</title>
    <style>
        .wrapper {
            width: 640px;
            height: 338px;
            background: #000;
        }

        video {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <video id="video" controls></video>
    </div>
    <script src="dist/mediasorcerer.js"></script>
    <script>
        var video = document.getElementById('video');

        new Promise(function(resolve, reject) {
            var xhr = new XMLHttpRequest();

            // Get dash url from https://player2.vimeo.dev/video/117770305/config
            xhr.open('GET', 'https://skyfiretest.vimeocdn.com/1444774493-0xbb63ccaa32e72e3cef2a2d1999dc2e2e56af5f7f/117770305/video/336610580,336610587,336610582,336610579,336610578,336610577/master.json');
            xhr.onreadystatechange = function() {
                if (xhr.status === 200 && xhr.readyState === 4) {
                    resolve(JSON.parse(xhr.responseText));
                }
            }
            xhr.send();
        }).then(function(config) {
            console.log(config);
            var sorcerer;

            config.video.forEach(function(obj, i) {
                var mime = obj.mime_type;
                var codec = obj.codecs;

                // Create the sorcerer obj
                if (i === 0) {
                     sorcerer = new MediaSorcerer(video, { duration: obj.duration });
                }

                var initialSegment = config.base_url + obj.base_url + obj.init_segment;
                sorcerer.addStream(mime + '; codecs="' + codec + '"', initialSegment);
            });

            var first = config.video[0];
            var index = 0;
            var firstSegment = config.base_url + first.base_url + first.segments[index].url;
            sorcerer.streams[0].addSegment(firstSegment, first.height + ' segment ' + (index + 1));

            window.config = config;
            window.sorcerer = sorcerer;
        }).catch(function(e) {
            console.log('Some error', e);
        });
    </script>
</body>
